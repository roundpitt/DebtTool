

var async = require('async');

var Plaid = require('./');

var sandboxClient = new Plaid.Client(
  process.env.PLAID_CLIENT_ID,
  process.env.PLAID_SECRET,
  process.env.PLAID_PUBLIC_KEY,
  Plaid.environments.sandbox
);

// var developmentClient = new Plaid.Client(
//   process.env.CLIENT_ID,
//   process.env.SECRET,
//   process.env.PUBLIC_KEY,
//   Plaid.environments.development
// );

// var productionClient = new Plaid.Client(
//   process.env.CLIENT_ID,
//   process.env.SECRET,
//   process.env.PUBLIC_KEY,
//   Plaid.environments.production
// );


// var item = sandboxClient.createItem({
//   username: 'user_good',
//   password: 'pass_good',
// }, 'ins_3', ['auth'], {webhook: 'http://requestb.in/18d89i41'}, function(err, mfa, result) {
//   if (err != null) {
//     console.log(err);
//   } else if (mfa != null) {
//     console.log(mfa);
//   } else {
//     console.log(result);
//     // developmentClient.getItem(result.access_token, (err, res) => {
//     //   console.log(err||res);
//     // });
//   }
// });

// const nock=require('nock');

// nock('https://sandbox.plaid.com').post('/institutions/get',{"secret":process.env.PLAID_SECRET,"client_id":process.env.PLAID_CLIENT_ID,"count":500,"offset":0}) .reply(503, 'oops')
// sandboxClient.createStripeToken('access-sandbox-31e7ab47-55ae-4162-8ae5-0457bc8fa224',, (err, res) => {
//   if (err != null) {
//     throw err;
//   } else {
//     console.log(res);
//   }
// });
// sandboxClient.getAccounts('access-sandbox-31e7ab47-55ae-4162-8ae5-0457bc8fa224', (err, result) => {
//   console.log(err||result);
//   console.log(result.accounts[0].account_id);
//   const accountId = result.accounts[0].account_id;
//   sandboxClient.createProcessorToken('access-sandbox-31e7ab47-55ae-4162-8ae5-0457bc8fa224', accountId, 'dwolla', (err, result) => {
//     console.log(err.toString()||result);
//   });
// })

// productionClient.getTransactions('access-production-b8dfc724-c72d-41cb-b000-846faa17e525', '2017-01-01', '2017-03-20', {foo_bar_baker_michael: 'hello-world'}, (err, data) => {
//   console.log(err);
//   debugger;
// });
// return;
// var V2_AMEX_TOKEN = 'access-development-0f7ed2b8-167b-4134-8b92-fdc228d19d24';

// developmentClient.getBalance(V2_AMEX_TOKEN, (err, res) => {
//   console.log(err||res);
// });


// var ACCESS_TOKEN = 'access-sandbox-101e68a9-e97e-42df-8036-71ead209d905';
// var V1_TOKEN = 'efadc25a343b52793118e82567ffd35a7467cf79c6fcf91735e082f4fba72ad81f1b4d5bd425996f821e96d472899bb50001015b2a4dec780373a14f01e1359b2a9c17445bbc8748399c3b3aeb97829f';
// var V2_TOKEN = 'access-development-522a2103-975d-467a-809e-98ee666cbd3c';
// access-sandbox-d27ab6f0-a3ac-49c9-8068-1107e729af9e

var item = sandboxClient.createItem({
  username: 'user_good',
  password: 'pass_good',
}, 'ins_100000', ['auth'], {webhook: 'http://requestb.in/1980pj41'}, (err, mfa, result) => {
  if (err != null) {
    console.log(err);
  } else if (mfa != null) {
    console.log(mfa);
    console.log('hit mfa');
  } else {
    console.log(result);
  }
});

return;

// async.waterfall([
//   function(cbk) {
//     // Retrieve numbers
//     developmentClient.getTransactions(V2_TOKEN, '2017-02-01', '2017-01-01', {count: 250, offset: 0},  (err, result) => {
//       // Handle err
//       // The Item has a list of available products, billed products, error status,
//       // webhook information, and more.
//       debugger;
//       var item = result.item;
//       console.log(result.transactions);
//     });
//   },
//   function(cbk) {
//     // Retrieve numbers
//     developmentClient.createPublicToken(ACCESS_TOKEN, (err, result) => {
//       // Handle err
//       // Use the generated public_token to initialize Plaid Link in update
//       // mode for a user's Item so that they can provide updated credentials
//       // or MFA information
//       var publicToken = result.public_token;
//       cbk();
//     });
//   }], err => {
//     debugger;
// });

